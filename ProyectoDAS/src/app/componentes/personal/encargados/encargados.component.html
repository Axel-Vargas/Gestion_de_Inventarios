<div class="grid">
    <div class="col-12">
        <div class="card">
            <div class="flex encargados justify-content-between flex-wrap mb-5">
                <span class="flex align-items-center">Encargados</span>
                <div *ngIf="rolUsuario === 1" class="flex align-items-center">
                    <span class="tooltip" [ngClass]="{'show': tooltipVisible}">Agregar encargado</span>
                    <button pButton icon="pi pi-plus" class="p-button-rounded p-2.5 text-l" (mouseenter)="showTooltip()"
                        (mouseleave)="hideTooltip()" (click)="showDialogAgregar()"></button>
                </div>
            </div>
            <p-table #dt [value]="encargados" dataKey="id_encargado" [rows]="5" [rowsPerPageOptions]="[5,10, 25, 50]"
                [paginator]="true" [globalFilterFields]="['cedula', 'nombre', 'apellido', 'telefono', 'direccion']"
                [tableStyle]="{ 'min-width': '95rem' }">
                <ng-template pTemplate="caption">
                    <div class="flex align-items-center justify-content-between">
                        <p-button *ngIf="rolUsuario === 1" label="Traspasar Bienes Libres" icon="pi pi-arrow-right" class="mr-2"
                            (click)="openTransferModalForNullEncargados()"></p-button>
                        <p-iconField iconPosition="left" class="ml-auto rounded-icon-field">
                            <p-inputIcon>
                                <i class="pi pi-search ml-2"></i>
                            </p-inputIcon>
                            <input pInputText type="text"
                                (input)="dt.filterGlobal($any($event.target).value, 'contains')"
                                placeholder="Buscar Encargado" class="ml-2" />
                        </p-iconField>
                    </div>
                </ng-template>
                <ng-template pTemplate="header">
                    <tr>
                        <th>
                            <span class="flex mb-2">CEDULA</span>
                            <p-columnFilter class="mt-5" [matchModeOptions]="matchModeOptions" type="text"
                                field="cedula" placeholder="Buscar por cédula" ariaLabel="Filter Cédula" />
                        </th>
                        <th>
                            <span class="flex mb-2">NOMBRE</span>
                            <p-columnFilter class="mt-5" [matchModeOptions]="matchModeOptions" type="text"
                                field="nombre" placeholder="Buscar por nombre" ariaLabel="Filter Nombre" />
                        </th>
                        <th>
                            <span class="flex mb-2">APELLIDO</span>
                            <p-columnFilter class="mt-5" [matchModeOptions]="matchModeOptions" type="text"
                                field="apellido" placeholder="Buscar por apellido" ariaLabel="Filter Apellido" />
                        </th>
                        <th>
                            <span class="flex mb-2">TELEFONO</span>
                            <p-columnFilter class="mt-5" [matchModeOptions]="matchModeOptions" type="text"
                                field="telefono" placeholder="Buscar por telefono" ariaLabel="Filter Telefono" />
                        </th>
                        <th>
                            <span class="flex mb-2">DIRECCION</span>
                            <p-columnFilter class="mt-5" [matchModeOptions]="matchModeOptions" type="text"
                                field="direccion" placeholder="Buscar por direccion" ariaLabel="Filter Direccion" />
                        </th>
                        <th *ngIf="rolUsuario === 1"></th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-encargado>
                    <tr>
                        <td>{{ encargado.cedula }}</td>
                        <td>{{ encargado.nombre }}</td>
                        <td>{{ encargado.apellido }}</td>
                        <td>{{ encargado.telefono }}</td>
                        <td>{{ encargado.direccion }}</td>
                        <td *ngIf="rolUsuario === 1" class="flex flex-row ">
                            <button pButton (click)="showDialogEditar(encargado)" pRipple type="button"
                                icon="pi pi-pen-to-square"
                                class="p-button p-component p-button-text p-button-icon-only flex align-items-center justify-content-center"></button>
                            <button pButton (click)="confirm(encargado.id_encargado)" pRipple type="button"
                                icon="pi pi-trash"
                                class="p-button p-component p-button-text p-button-trash flex align-items-center justify-content-center"></button>
                            <button pButton (click)="showDialogPasoDeBien(encargado)" pRipple type="button"
                                icon="pi pi-arrow-right-arrow-left"
                                class="p-button p-component p-button-text p-button-trash flex align-items-center justify-content-center"></button>
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="5">No se encontraron encargados.</td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </div>
</div>

<p-dialog [header]="esEdicion ? 'Editar Encargado' : 'Agregar Encargado'" [modal]="true" [(visible)]="visible"
    [style]="{ width: '36rem'}">
    <div class="flex flex-wrap gap-3">
        <div class="flex align-items-left gap-3 mb-3 flex-column" style="max-width: 50%;">
            <label for="cedula" class="font-semibold w-6rem">Cédula</label>
            <input pInputText id="cedula" class="flex-auto" autocomplete="off" [(ngModel)]="cedula" maxlength="10"
                (input)="handleInputCedula($event)" />
            <div class="mensaje-cedula"
                [ngClass]="{'valido': mensajeValidacionCedula === 'Cédula válida', 'invalido': mensajeValidacionCedula === 'Cédula inválida'}">
                {{ mensajeValidacionCedula }}
            </div>
        </div>
        <div class="flex align-items-left gap-3 mb-3 flex-column" style="max-width: 50%;">
            <label for="nombre" class="font-semibold w-6rem">Nombre</label>
            <input pInputText id="nombre" autocomplete="off" [(ngModel)]="nombre" maxlength="20"
                (input)="handleInput($event)" />
        </div>
        <div class="flex align-items-left gap-3 mb-3 flex-column" style="max-width: 50%;">
            <label for="apellido" class="font-semibold w-6rem">Apellido</label>
            <input pInputText id="apellido" class="flex-auto" autocomplete="off" [(ngModel)]="apellido" maxlength="20"
                (input)="handleInput($event)" />
        </div>
        <div class="flex align-items-left gap-3 mb-3 flex-column" style="max-width: 50%;">
            <label for="telefono" class="font-semibold w-6rem">Teléfono</label>
            <input pInputText id="telefono" class="flex-auto" autocomplete="off" [(ngModel)]="telefono" maxlength="10"
                (input)="handleInputNumbers($event)" />
        </div>
        <div class="flex align-items-left gap-3 mb-3 flex-column" style="max-width: 50%;">
            <label for="direccion" class="font-semibold w-6rem">Dirección</label>
            <input pInputText id="direccion" class="flex-auto" autocomplete="off" [(ngModel)]="direccion"
                maxlength="25" />
        </div>
    </div>
    <div class="flex justify-content-end gap-2">
        <p-button [label]="esEdicion ? 'Editar' : 'Guardar'"
            (click)="esEdicion ? editarEncargado() : registrarEncargado()" (click)="visible = false"
            [rounded]="true"></p-button>
    </div>
</p-dialog>


<p-dialog header="Traspaso de Bienes" [(visible)]="displayModalBienes" modal="true"
    [style]="{width: '600px', height: '500px'}">
    <div class="flex flex-column gap-2" [style]="{ height: '85%'}">
        <div class="flex align-items-center flex-row">
            <p-dropdown [options]="encargados" dataKey="id_encargado" [(ngModel)]="selectedEncargado"
                optionLabel="nombreCompleto" placeholder="Seleccione un nuevo encargado"
                [style]="{width: '100%'}"></p-dropdown>
        </div>
        <div class="flex flex-row gap-2" [style]="{ height: 'calc(100% - 2rem)'}">
            <div class="flex flex-column flex-1 overflow-auto" style="max-height: calc(100% - 2rem);">
                <p-button class="mb-2 small-rounded-button" [style]="{width: '100%'}" label="Mover Todos"
                    icon="pi pi-angle-double-right" (click)="moveAllToTarget()"
                    [disabled]="!selectedEncargado"></p-button>
                <div class="p-2 border-1 surface-border border-round flex-1 overflow-auto">
                    <ul class="list-none flex flex-column gap-2 p-0 m-0">
                        <li *ngFor="let bien of sourceBienes" class="p-2 border-round shadow-1" pDraggable
                            (onDragStart)="dragStart(bien)" (onDragEnd)="dragEnd()">
                            {{bien.nombre}}/{{bien.codigoUTA}}
                        </li>
                    </ul>
                </div>
            </div>
            <div class="flex flex-column flex-1 overflow-auto" style="max-height: calc(100% - 2rem);">
                <p-button class="mb-2 small-rounded-button" [style]="{width: '100%'}" label="Mover Todos"
                    icon="pi pi-angle-double-left" (click)="moveAllToSource()"
                    [disabled]="!selectedEncargado"></p-button>
                <div class="p-2 border-1 surface-border border-round flex-1 overflow-auto" pDroppable (onDrop)="drop()">
                    <ul class="list-none flex flex-column gap-2 p-0 m-0">
                        <li *ngFor="let bien of targetBienes" class="p-2 border-round shadow-1" pDraggable>
                            {{bien.nombre}}/{{bien.codigoUTA}}
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="flex justify-content-end gap-2 mt-auto">
            <p-button label="Cancelar" icon="pi pi-times" (click)="cancelTransfer()"
                class="small-rounded-button"></p-button>
            <p-button label="Confirmar" icon="pi pi-check" (click)="confirmTransfer()"
                [disabled]="targetBienes.length === 0 || !selectedEncargado" class="small-rounded-button"></p-button>
        </div>
    </div>
</p-dialog>
<p-toast position="bottom-right"></p-toast>
<p-confirmDialog header="Confirmación" icon="pi pi-exclamation-triangle" width="425"></p-confirmDialog>