
<div class="grid">
    <div class="col-12">
        <div class="card">
            <div class="flex mobiliarios justify-content-between flex-wrap mb-5">
                <span class="flex mobiliarios align-items-center">Tipos Tecnológicos</span>
                <div class="flex align-items-center">
                  <span class="tooltip" [ngClass]="{'show': tooltipVisible}">Agregar Bien</span>
                  <button pButton icon="pi pi-plus" class="p-button-rounded p-2.5 text-l" (mouseenter)="showTooltip()"
                    (mouseleave)="hideTooltip()" (click)="openNew()"></button>
                </div>
              </div>

              <p-table [paginator]="true" [rowsPerPageOptions]="[10, 20, 30]" [scrollable]="true" scrollHeight="380px" [rows]="10" [value]="tiposTecnologicos" [customSort]="true" [tableStyle]="{'min-width': '60rem'}">
                <ng-template pTemplate="header">
                  <tr>
                    <th pSortableColumn="nom_tecnologico" style="width:20%">NOMBRE TECNOLÓGICO<p-sortIcon field="nom_tecnologico"></p-sortIcon></th>
                    <th pSortableColumn="atributos" style="width:20%">ATRIBUTOS <p-sortIcon field="atributos"></p-sortIcon></th>
                    <th style="width:20%">OPCIONES </th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-tipo>
                  <tr>
                    <td>{{tipo.nom_tecnologico}}</td>
                    <td>
                      <ul>
                        <li *ngFor="let key of getAtributosKeys(tipo.atributos)">{{ key }}</li>
                      </ul>
                    </td>
                    <td class="flex flex-row align-items-center sm:flex-col" style="gap: 8px">
                      <button type="button" (click)="editTipoTecnologico(tipo)" class="p-button p-button-sm p-button-info" title="Editar">
                        <i class="pi pi-pencil"></i>
                      </button>
                      <button type="button" (click)="deleteTipoTecnologico(tipo.id)" class="p-button p-button-sm p-button-danger" title="Eliminar">
                        <i class="pi pi-trash"></i>
                      </button>

                    </td>
                  </tr>
                </ng-template>
              </p-table>


              <p-dialog header="{{ isEditing ? 'Editar' : 'Nuevo' }} Tipo Tecnológico" [(visible)]="displayModal" [modal]="true" draggable="false" [closable]="true"[style]="{ width: '90%', 'max-width': '500px', 'min-width': '300px' }">
                <form (ngSubmit)="saveTipoTecnologico()">
                    <div class="formgrid grid">
                        <div class="field col">
                            <label for="nom_tecnologico">Nombre</label>
                            <input id="nom_tecnologico" 
                            class="text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full"
                            [(ngModel)]="selectedTipoTecnologico!.nom_tecnologico" name="nom_tecnologico"  required>

                        </div>
                    </div>
                    
                    <div class="formgrid grid">
                        <div class="field col">
                               <label for="nom_tecnologico">Atributos</label>
                               <button pButton pRipple type="button" (click)="openModal()" label="Agregar Atributos" class="p-button-secondary  p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full"></button>
                        
                        </div>
                    </div>
                    <div class="formgrid grid">
                      <div class="field col">
                          <!-- Mostrar atributos ingresados -->
                          <div *ngIf="selectedTipoTecnologico && selectedTipoTecnologico.atributos">
                            <div *ngFor="let atributo of parseAtributos(selectedTipoTecnologico.atributos)">
                              <div>
                                  {{ atributo }}
                                  <button pButton pRipple type="button" icon="pi pi-times" (click)="removeAtributo(atributo)" class="p-button-rounded p-button-danger p-button-text"></button>
                              </div>
                            </div>
                          </div>
                      </div>
                    </div>
                  
                  <p-footer class="flex justify-content-end gap-3">
                    <p-button type="submit" label="Guardar"></p-button>
                    <p-button type="button" label="Cancelar" class="p-button-secondary" (click)="displayModal = false"></p-button>
                  </p-footer>
                </form>
              </p-dialog>


              <p-dialog header="Agregar Atributos" [(visible)]="displayModalAtributos" [modal]="true" [style]="{ width: '30vw' }">
                <form (ngSubmit)="agregarAtributo()">
                  <div class="formgrid grid">
                    <div class="field col">
                        <label for="clave">Nombre del atributo</label>
                        <input id="clave" type="text" [(ngModel)]="nuevoAtributo" name="clave" class="text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full" required>
                    </div>
                  </div>
                  <p-footer class="flex justify-content-end gap-3">
                      <button type="submit" pButton label="Agregar" class="p-button-primary"></button>
                      <button type="button" pButton label="Cancelar" class="p-button-secondary" (click)="cancelarModal()"></button>
                  </p-footer>
                </form>
            </p-dialog>

            <p-toast position="bottom-center" key="bc"></p-toast>
            <p-confirmDialog [breakpoints]="{'960px': '75vw', '640px': '100vw'}" [style]="{width: '50vw'}" header="Eliminar" icon="pi pi-exclamation-triangle"></p-confirmDialog>
        </div>
    </div>
</div>